# SPDX-FileCopyrightText: 2025 ETH Zurich and University of Bologna
#
# SPDX-License-Identifier: Apache-2.0

---
name: CI â€¢ Snitch (Tiled)

"on":
  push:
    branches:
      - "**"
    tags:
      - "v*.*.*"
  pull_request:
  workflow_dispatch:
    inputs:
      docker_image_deeploy:
        description: "Deeploy Image to use"
        required: false
        default: "ghcr.io/pulp-platform/deeploy:devel"

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  select-env:
    uses: ./.github/workflows/_select-env.yml
    with:
      docker_image_deeploy: ${{ inputs.docker_image_deeploy }}

  snitch-kernels-tiled-singlebuffer-L2:
    needs: select-env
    uses: ./.github/workflows/_runner-snitch-tiled-sequential.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      tests-config: |
        [
          {"name":"Kernels/Integer/Add/Large","L1":[5000,10000]},
          {"name":"Kernels/Integer/Softmax/Large","L1":[5000,10000]},

          {"name":"Kernels/FP32/Softmax/Regular","L1":[2000,5000,10000]},
          {"name":"Kernels/FP32/RMSNorm_fused","L1":[2000,5000,10000]},
          {"name":"Kernels/FP32/MatMul","L1":[2000,5000,10000]},
          {"name":"Kernels/FP32/Add/Regular","L1":[2000,5000,10000]},
          {"name":"Kernels/FP32/Hardswish","L1":[2000,5000,10000]},
          {"name":"Kernels/FP32/Div","L1":[2000,5000,10000]},

          {"name":"Kernels/FP32/GEMM/Regular","L1":[2000,5000,10000]},
          {"name":"Kernels/FP32/GEMM/TransB","L1":[2000,5000,10000]},

          {"name":"Kernels/Integer/iNoNorm","L1":[5000,10000]},
          {"name":"Kernels/Integer/Add/Regular_RQ","L1":[5000,10000]},
          {"name":"Kernels/Integer/GEMM/Regular_RQPerRow","L1":[2000,5000]},

          {"name":"Models/microLlama/microLlama_fp32_1","L1":[10000,20000]}
        ]
      simulators: |
        gvsoc
