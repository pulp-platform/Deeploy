# SPDX-FileCopyrightText: 2025 ETH Zurich and University of Bologna
#
# SPDX-License-Identifier: Apache-2.0

---
name: CI â€¢ Mempool

"on":
  push:
    branches:
      - "**"
    tags:
      - "v*.*.*"
  pull_request:
  workflow_dispatch:
    inputs:
      docker_image_deeploy:
        description: "Deeploy Image to use"
        required: false
        default: "ghcr.io/pulp-platform/deeploy:devel"

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  select-env:
    uses: ./.github/workflows/_select-env.yml
    with:
      docker_image_deeploy: ${{ inputs.docker_image_deeploy }}

  mempool-kernels:
    needs: select-env
    uses: ./.github/workflows/_runner-mempool.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      pytest-marker: "kernels"
      # test-names: |
      #   Kernels/Integer/Add/MultIO
      #   Kernels/Integer/Add/Regular

      #   Kernels/Integer/Conv/DW_1D
      #   Kernels/Integer/Conv/Regular_1D

      #   Kernels/Integer/Conv/DW_2D
      #   Kernels/Integer/Conv/Regular_2D

      #   Kernels/Integer/GEMM/Regular

      #   Kernels/Integer/MatMul/Add
      #   Kernels/Integer/MatMul/Regular

      #   Kernels/Integer/MaxPool

      #   Kernels/Integer/Pad/Regular_1D
      #   Kernels/Integer/Pad/Regular_2D

      #   Kernels/Integer/ReduceMean
      #   Kernels/Integer/ReduceSum

      #   Kernels/Integer/Slice

      #   Kernels/Integer/Conv/Regular_2D_RQ
      #   Kernels/Integer/Conv/DW_2D_RQ
      #   Kernels/Integer/GEMM/Regular_RQPerRow
      #   Kernels/Integer/MatMul/Regular_RQ

  mempool-models:
    needs: select-env
    uses: ./.github/workflows/_runner-mempool.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      pytest-marker: "models"
      # test-names: |
      #   Models/CCT/Int/ICCT
      #   Models/CCT/Int/ICCT_8
      #   Models/CCT/Int/ICCT_ITA

      #   Models/miniMobileNet
      #   Models/miniMobileNetv2

      #   Models/CNN_Linear1

      #   Models/CNN_Linear2
