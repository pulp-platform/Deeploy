# Copyright 2025 ETH Zurich and University of Bologna.
# Licensed under the Apache License, Version 2.0, see LICENSE for details.
# SPDX-License-Identifier: Apache-2.0

---
name: CI â€¢ Generic

"on":
  push:
    branches:
      - "**"
    tags:
      - "v*.*.*"
  pull_request:
  workflow_dispatch:
    inputs:
      docker_image_deeploy:
        description: "Deeploy Image to use"
        required: false
        default: "ghcr.io/pulp-platform/deeploy:devel"

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  select-env:
    uses: ./.github/workflows/_select-env.yml
    with:
      docker_image_deeploy: ${{ inputs.docker_image_deeploy }}

  generic-kernels:
    needs: select-env
    uses: ./.github/workflows/_runner-generic.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      test-names: |
        Adder
        MultIO
        test1DConvolution
        test2DConvolution
        test1DDWConvolution
        test2DDWConvolution
        test1DPad
        test2DPad
        testGEMM
        testMatMul
        testMatMulAdd
        testMaxPool
        testRQConv
        testRQMatMul
        testReduceSum
        testReduceMean
        testSlice
        testRequantizedDWConv
        test2DRequantizedConv
        iSoftmax
        testFloatAdder
        testFloatGEMM
        testFloat2DConvolution
        testFloat2DConvolutionBias
        testFloat2DConvolutionZeroBias
        testFloatLayerNorm
        testFloatDiv
        testFloat2DDWConvolution
        testFloat2DDWConvolutionBias
        testFloat2DDWConvolutionZeroBias
        testFloatRelu
        testFloatMaxPool
        testFloatMatmul
        testFloatReshapeWithSkipConnection
        testFloatSoftmax
        testFloatTranspose
        testFloatMul
        Quant
        Dequant
        QuantizedLinear

  generic-models:
    needs: select-env
    uses: ./.github/workflows/_runner-generic.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      test-names: |
        simpleRegression
        WaveFormer
        simpleCNN
        ICCT
        ICCT_ITA
        ICCT_8
        ICCT_ITA_8
        miniMobileNet
        miniMobileNetv2
        CCT/CCT_1_16_16_8
        testFloatDemoTinyViT
