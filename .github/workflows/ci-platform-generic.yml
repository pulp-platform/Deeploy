# SPDX-FileCopyrightText: 2025 ETH Zurich and University of Bologna
#
# SPDX-License-Identifier: Apache-2.0

---
name: CI â€¢ Generic

"on":
  push:
    branches:
      - "**"
    tags:
      - "v*.*.*"
  pull_request:
  workflow_dispatch:
    inputs:
      docker_image_deeploy:
        description: "Deeploy Image to use"
        required: false
        default: "ghcr.io/pulp-platform/deeploy:devel"

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  select-env:
    uses: ./.github/workflows/_select-env.yml
    with:
      docker_image_deeploy: ${{ inputs.docker_image_deeploy }}

  generic-kernels:
    needs: select-env
    uses: ./.github/workflows/_runner-generic.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      test-names: |
        Adder

        FP32Kernels/Activations/ReLU

        FP32Kernels/Conv2D/DWBias
        FP32Kernels/Conv2D/DWNoBias
        FP32Kernels/Conv2D/DWZeroValuedBias

        FP32Kernels/Conv2D/RegularBias
        FP32Kernels/Conv2D/RegularNoBias
        FP32Kernels/Conv2D/RegularZeroValuedBias

        FP32Kernels/ReduceMean/KeepDims/AllAxes
        FP32Kernels/ReduceMean/KeepDims/Axes0_1_2_3
        FP32Kernels/ReduceMean/KeepDims/Axes1_3
        FP32Kernels/ReduceMean/KeepDims/Axes2_1
        FP32Kernels/ReduceMean/KeepDims/Axis0
        FP32Kernels/ReduceMean/KeepDims/Axis2

        FP32Kernels/ReduceMean/NoKeepDims/AllAxes
        FP32Kernels/ReduceMean/NoKeepDims/Axes0_1_2_3
        FP32Kernels/ReduceMean/NoKeepDims/Axes1_3
        FP32Kernels/ReduceMean/NoKeepDims/Axes2_1
        FP32Kernels/ReduceMean/NoKeepDims/Axis0
        FP32Kernels/ReduceMean/NoKeepDims/Axis2

        FP32Kernels/SkipConnection/ReshapeWithSkipConnection

        MultIO
        test1DConvolution
        test2DConvolution
        test1DDWConvolution
        test2DDWConvolution
        test1DPad
        test2DPad
        testGEMM
        testMatMul
        testMatMulAdd
        testMaxPool
        testRQConv
        testRQMatMul
        testReduceSum
        testReduceMean
        testSlice
        testRequantizedDWConv
        test2DRequantizedConv
        iSoftmax
        testFloatAdder
        testFloatGEMM
        testFloatLayerNorm
        testFloatDiv
        testFloatMaxPool
        testFloatMatmul
        testFloatSoftmax
        testFloatTranspose
        testFloatMul
        testFloatPowScalar
        testFloatPowVector
        testFloatSqrt
        testFloatRMSNorm
        Quant
        Dequant
        QuantizedLinear

  generic-models:
    needs: select-env
    uses: ./.github/workflows/_runner-generic.yml
    with:
      runner: ${{ needs.select-env.outputs.runner }}
      docker-image: ${{ needs.select-env.outputs.image }}
      test-names: |
        simpleRegression
        WaveFormer
        simpleCNN
        ICCT
        ICCT_ITA
        ICCT_8
        ICCT_ITA_8
        miniMobileNet
        miniMobileNetv2
        CCT/CCT_1_16_16_8
        CCT/CCT_2_32_32_128_Opset20
        testFloatDemoTinyViT
        Autoencoder1D
